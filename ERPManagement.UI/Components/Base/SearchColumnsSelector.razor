@typeparam TModel
@inject IStringLocalizer<SearchColumnsSelector> localizer

<div class="dropdown w-100">
    <button class="btn btn-outline-primary w-100 text-start"
            type="button"
            @onclick="ToggleDropdown">
        @(SelectedColumns.Any()
                ? string.Join(", ", SelectedColumns.Select(c => Localizer?[c] ?? c))
                : (localizer?["SelectColumns"] ?? "Select Columns"))
    </button>

    @if (IsDropdownOpen)
    {
        <ul class="dropdown-menu show p-2 w-100" style="max-height:300px; overflow:auto;">
            <!-- البحث -->
            <li class="mb-2">
                <input type="text"
                       class="form-control form-control-sm "
                       placeholder="@localizer["Search..."]"
                       @bind="SearchText"
                       @bind:event="oninput"
                        />
            </li>

            <!-- Select/Unselect -->
            <li class="d-flex justify-content-between mb-2">
                <button type="button" class="btn btn-sm btn-success me-1" @onclick="SelectAll">@localizer["Select All"]</button>
                <button type="button" class="btn btn-sm btn-danger" @onclick="UnselectAll">@localizer["Unselect All"]</button>
            </li>

            <!-- الأعمدة -->
            @foreach (var col in FilteredColumns)
            {
                if (!InvisibleColumns.Contains(col))
                {
                    <li>
                        <label class="form-check-label w-100">
                            <input type="checkbox"
                                   class="form-check-input me-2"
                                   value="@col"
                                   checked="@SelectedColumns.Contains(col)"
                                   @onchange="() => ToggleColumn(col)" />
                            @Localizer?[col]
                        </label>
                    </li>
                }
            }
        </ul>
    }
</div>

@if (SelectedColumns.Any())
{
    <div class="mt-2">
        @foreach (var col in SelectedColumns)
        {
            <span class="badge bg-primary me-1">
                @Localizer?[col]
                <button type="button" class="btn-close btn-close-white btn-sm ms-1"
                        style="font-size:0.6rem"
                        @onclick="() => RemoveColumn(col)"></button>
            </span>
        }
    </div>
}
